---
title: Slid(er)ing Into Batters' DMs
subtitle: How and Why Usage of the Slider Has Changed Across Major League Baseball
author: Nathan Strozewski
# output: 
#     cleanrmd::html_document_clean:
#               theme: vanilla
---

### A Brief History of Sabermetrics
  
  
Major League Baseball (MLB) has pioneered the use of statistics and biometric data to inform both sport and business decisions. Popularized by the 2011 film [*Moneyball*](https://www.imdb.com/title/tt1210166/), a field of study called "sabermetrics" (after the [Society for American Baseball Research](https://sabr.org/)), has developed around this data analysis.
  
  
The ability to track limited pitch data, such as location and speed, first became available in 2008 thanks to the installation of [PITCHf/x](https://www.trackman.com/baseball) systems in al 30 MLB stadiums. In 2015, [Statcast](https://www.mlb.com/glossary/statcast) systems were also installed that now enable nearly every ball and player movement to be tracked. For pitchers, advanced metrics such as ball spin rate and movement, as well as pitcher arm extension, angle, and release point are now available. On the batting side, batter swing plane and angle, and ball exit velocity, and launch angle are recorded. The sprint speed and acceleration, distance traveled, and route are tracked for all players simultaneously. And the trajectory of every ball in play is recorded.
  
  
The availability of this advanced data enables team-driven statistical analysis to inform in-game strategies, scouting, player development, injury prevention and rehabilitation, player acquisitions, contract negotiations, and team business strategies such as ticket and concession sales, partnerships, and marketing. Much of Statcast data is made publicly at [Baseball Savant](https://baseballsavant.mlb.com/) - leading to growth of amateur sabermetric communities such as [Fangraphs Community Research](https://community.fangraphs.com/).
  
  
### Scope of This Report. 

I like baseball. And I like data. And I also have a data analysis assignment for BIOL 607 / 697. I could (and probably should) do an analysis on data that will contribute to my thesis. But my entire life revolves around those research projects. I'd rather have some fun with sabermetrics instead.  

I'm particularly interested in how pitchers strategize against batters.  

![](strasburg%20pitch%20overlay.mp4)  

Image credit: [DigitalOptics](https://gfycat.com/canineultimatecrustacean)  

Pitchers have an arsenal of different pitches that move in different directions and travel at different velocities. Different pitches are often used in sequences to disrupt a hitter's timing and balance. Hopefully causing the hitter to either swing and miss for a strike or hit the ball weakly so that a fielder can make an easy play.  

![](bauer%20pitch%20overlay.mp4)  

Image credit: [DigitalOptics](https://gfycat.com/snarlinggenerousjapanesebeetle-trevor-bauer-baseball-indians-sports)  

Pitchers have quite the advantage in these match-ups. In fact, the rules [have been modified in the past](https://bosoxinjection.com/2013/12/13/pitching-mound-history/) to create more balance and the MLB is currently experimenting with [moving the pitcher's mound](https://www.bleachernation.com/cubs/2022/01/13/the-atlantic-league-is-all-done-with-mlbs-move-the-mound-back-rule-change/) farther back to give hitters more time to react to pitches. They're also (secretly) [testing different baseball compositions](https://www.foxnews.com/sports/study-shows-mlb-used-three-different-baseballs-in-2022-after-admitting-two-were-used-last-season) to influence how pitches move and how batted balls travel.  

There's a lot that goes into pitching strategy. But the most obvious component is deciding which pitch to use. Anecdotally, I've noticed that the slider pitch is being used much more frequently than in the past. I have no evidence to back this up. But I know how I can find out if this is true (hint: it's with R Studio).  

I'd like to start by analyzing pitch usage over time. Because baseball strategy is driven so heavily by analytics, any change in pitch usage is likely to be an intentional decision based on data that suggests that certain pitches correlate to positive or negative outcomes for the pitcher. After identifying changes in pitch usage, I'd like to try to identify why these changes have occurred by comparing pitch outcomes across different pitch types.  

Following this, I plan to fit a linear model to determine how pitch factors contribute to positive pitch outcomes. The exact pitch outcomes are TBD - this depends on what my initial analyses reveal. It's likely that I'll use exit velocity as a proxy likelihood that fielders will convert the batted ball into an out. I might also use the percentage of hitter swings that result in a miss (i.e., whiffs). The predictor variables are also TBD and will be dependent on initial analyses. But I expect pitch velocity and movement to be key influencers of pitch outcome.  

I hypothesize that usage of the slider has increased. I also hypothesize that usage of the slider leads to a higher likelihood of positive pitcher outcomes than other pitches. Lastly, I hypothesize that the two strongest predictors of positive pitch outcomes for sliders will be pitch velocity and vertical movement.  

### Analysis of Pitch Usage Over Time

```{r custom theme, echo = FALSE, message = FALSE}

custom_theme <- function() { 
  font <- "Helvetica" # font selection
    
    theme_minimal() %+replace% # theme based on minimal with following replacements
    
    theme(panel.grid.major = element_blank(), # leave grids and axis ticks blank
          panel.grid.minor = element_blank(),
          axis.ticks = element_blank(),
          axis.line = element_line(color = "black",
                                   size = 1),
          panel.border = element_rect(color = "black",
                                      fill=NA,
                                      size=1),
          plot.title = element_text(family = font,
                                    size = 20,
                                    face = 'bold',
                                    hjust = 0.5, # move title to center horizontally
                                    vjust = 2), # move title up a wee bit
          plot.subtitle = element_text(family = font,
                                       size = 15,
                                       hjust = 0.5),
          plot.caption = element_text(family = font,
                                      size = 10,
                                      hjust = 1), # put caption in right corner
          axis.title = element_text(family = font,
                                    face = 'italic',
                                    size = 15),
          axis.text = element_text(family = font,
                                   size = 10),
          axis.text.x = element_text(margin = margin(t = 2, # top
                                                     r = 2, # right
                                                     b = 2, # bottom
                                                     l = 2))) # left
}

```

All data used in the analyses of this report are obtained from [Baseball Savant's Statcast Search](https://baseballsavant.mlb.com/statcast_search). Here, I filtered and downloaded all available pitch usage and outcome data by year, for each pitch. Since I am curious about pitch usage patterns on the largest scale, I considered all pitcher and batter handedness-es (i.e., righties and lefties for both) together. Only pitchers that at least 100 total pitches in a year were considered to minimize influence of small sample sizes stemming from minor-league call-ups and position-player pitches.

```{r initial data aggregation, echo = FALSE, message = FALSE, results = FALSE}

library(dplyr) # data manip
library(data.table) # creating dfs

# function to compile .csv files per pitch and organize
pitch_usage_aggregate_function <- function(pitch_usage_files_path) {
  
pitch_usage_aggregate <- rbindlist(mapply(c,(list.files(path = pitch_usage_files_path,
                                                  pattern = "*.csv",
                                                  full.names = TRUE) %>%
                                               lapply(read.table,
                                                      header = TRUE,
                                                      sep = ",",
                                                      encoding = "UTF-8")),
                                          (list.files(path = pitch_usage_files_path,
                                                      pattern = "*.csv",
                                                      full.names = TRUE) %>%
                                             basename() %>%
                                             as.list()),
                                          SIMPLIFY = FALSE),
                                   fill = T) %>% 
  mutate(year = substr(V1, 1, 4)) %>% # pull year from col V1
  mutate(pitch = substr(V1, 6, 9)) %>% # pull pitch abr from col V1
  mutate(pitch = recode(pitch, Chan = 'Change', Cutt = 'Cutter', Curv =  'Curveball',
                        Fast = 'Fastball', Sink = 'Sinker', Slid = 'Slider')) %>% 
  select(-c(pos3_int_start_distance, pos4_int_start_distance,
            pos5_int_start_distance, pos6_int_start_distance, 
            pos7_int_start_distance, pos8_int_start_distance, 
            pos9_int_start_distance, V1)) %>% # remove select cols
  select(player_name, player_id, year:pitch, pitches:pitch_percent, spin_rate:velocity,
         release_extension, effective_speed, eff_min_vel, ba:launch_angle,
         whiffs:takes) # reorder cols
  
return(as.data.frame(pitch_usage_aggregate))
}

# set paths to pitch files
changeup_usage_path <- "Data/Pitch Usage/Change"
curveball_usage_path <- "Data/Pitch Usage/Curveball"
cutter_usage_path <- "Data/Pitch Usage/Cutter"
fastball_usage_path <- "Data/Pitch Usage/Fastball"
sinker_usage_path <- "Data/Pitch Usage/Sinker"
slider_usage_path <- "Data/Pitch Usage/Slider"

# aggregate pitch files into dfs

changeup_usage_aggregate <- pitch_usage_aggregate_function(changeup_usage_path)
curveball_usage_aggregate <- pitch_usage_aggregate_function(curveball_usage_path)
cutter_usage_aggregate <- pitch_usage_aggregate_function(cutter_usage_path)
fastball_usage_aggregate <- pitch_usage_aggregate_function(fastball_usage_path)
sinker_usage_aggregate <- pitch_usage_aggregate_function(sinker_usage_path)
slider_usage_aggregate <- pitch_usage_aggregate_function(slider_usage_path)

# list of all aggregate dfs
master_pitch_usage_aggregate_list <- list(changeup_usage_aggregate = changeup_usage_aggregate,
                                         curveball_usage_aggregate = curveball_usage_aggregate,
                                         cutter_usage_aggregate = cutter_usage_aggregate,
                                         fastball_usage_aggregate = fastball_usage_aggregate,
                                         sinker_usage_aggregate = sinker_usage_aggregate,
                                         slider_usage_aggregate = slider_usage_aggregate)

# write aggregate dfs into .csv files
mapply(write.csv, 
       master_pitch_usage_aggregate_list, 
       file=paste0(names(master_pitch_usage_aggregate_list),
                   '.csv'))

# combine aggregate dfs into one master df
master_pitch_usage_aggregate <- rbind(changeup_usage_aggregate,
                                      curveball_usage_aggregate,
                                      cutter_usage_aggregate,
                                      fastball_usage_aggregate,
                                      sinker_usage_aggregate,
                                      slider_usage_aggregate)

# write master df to .csv file
write.csv(master_pitch_usage_aggregate,
          "Data/Pitch Usage/Aggregated Files/master_pitch_usage_aggregate.csv",
          row.names = TRUE)

```

Sweet. Now I need to do a couple of things. I need to first take all this data and calculate means for each that are weighted by pitch number (to avoid biasing analyses). Since more advanced metrics are only available post-Statcast implementation (\~2015), I'll need to do this two separate ways: first for the common metrics across all years and second across common and Statcast metrics across Statcast-era years.

```{r pitch usage stats, echo = FALSE, message = FALSE}

library(tidyr)

# aggregate all pitch usage stats
master_pitch_usage_summary <- master_pitch_usage_aggregate %>% 
  group_by(year, pitch) %>% 
  filter(total_pitches > 100) %>%
  select(-c(player_name, total_pitches, pitch_percent, ba)) %>%
  summarise(pitch_count = sum(pitches),
            sum_whiffs = sum(whiffs),
            sum_swings = sum(swings),
            sum_takes = sum(takes),
            sum_abs = sum(abs),
            sum_hits = sum(hits),
            mean_spin_rate = weighted.mean(spin_rate, pitches),
            mean_velocity = weighted.mean(velocity, pitches),
            mean_release_extension = weighted.mean(release_extension, pitches),
            mean_effective_speed = weighted.mean(effective_speed, pitches),
            mean_eff_min_vel = weighted.mean(eff_min_vel, pitches),
            mean_iso = weighted.mean(iso, pitches),
            mean_babip = weighted.mean(babip, pitches),
            mean_slg = weighted.mean(slg, pitches),
            mean_woba = weighted.mean(woba, pitches),
            mean_xwoba = weighted.mean(xwoba, pitches),
            mean_xba = weighted.mean(xba, pitches),
            mean_launch_speed = weighted.mean(launch_speed, pitches),
            mean_launch_angle = weighted.mean(launch_angle, pitches)) %>% 
  mutate(ba = sum_hits / sum_abs,
         swing_percentage = sum_swings / pitch_count,
         whiff_percentage = sum_whiffs / sum_swings,
         contact_rate = (sum_swings - sum_whiffs) / sum_swings,
         take_percentage = sum_takes / pitch_count)

# save and export
write.csv(master_pitch_usage_summary,
          "Data/Pitch Usage/Statistics/master_pitch_usage_summary.csv",
          row.names = TRUE)

# calculate total number of pitches per year
total_pitches <- master_pitch_usage_aggregate %>% 
  group_by(year, pitch) %>%
  summarise(pitch_count = sum(pitches)) %>% 
  ungroup() %>% 
  group_by(year) %>% 
  summarise(total_pitches = sum(pitch_count)) %>% 
  slice(rep(1:n(), each = 6)) %>% # rep 6 times to fit future need (see pitch_percentages)
  as.data.frame()

# calculate pitch usage %s

library(tibble) # add_col fun

master_pitch_usage_percentages <- master_pitch_usage_aggregate %>% 
  group_by(year, pitch) %>% 
  filter(total_pitches > 100) %>%
  summarise(pitch_count = sum(pitches)) %>% 
  select(year, pitch, pitch_count) %>% 
  ungroup() %>%
  add_column(all_pitches = total_pitches$total_pitches) %>% 
  mutate(pitch_usage = pitch_count/all_pitches)

# write the .csv
write.csv(master_pitch_usage_percentages,
          "Data/Pitch Usage/Statistics/master_pitch_usage_percentages.csv",
          row.names = TRUE)

# calc statcast era statistics - for use in full analyses
master_statcast_summary <- master_pitch_usage_aggregate %>% 
  group_by(year, pitch) %>% 
  filter(total_pitches > 100) %>%
  select(-c(player_name, total_pitches, pitch_percent, ba)) %>% 
  drop_na() %>% 
  summarise(pitch_count = sum(pitches),
            sum_whiffs = sum(whiffs),
            sum_swings = sum(swings),
            sum_takes = sum(takes),
            sum_abs = sum(abs),
            sum_hits = sum(hits),
            mean_spin_rate = weighted.mean(spin_rate, pitches),
            mean_velocity = weighted.mean(velocity, pitches),
            mean_release_extension = weighted.mean(release_extension, pitches),
            mean_effective_speed = weighted.mean(effective_speed, pitches),
            mean_eff_min_vel = weighted.mean(eff_min_vel, pitches),
            mean_iso = weighted.mean(iso, pitches),
            mean_babip = weighted.mean(babip, pitches),
            mean_slg = weighted.mean(slg, pitches),
            mean_woba = weighted.mean(woba, pitches),
            mean_xwoba = weighted.mean(xwoba, pitches),
            mean_xba = weighted.mean(xba, pitches),
            mean_launch_speed = weighted.mean(launch_speed, pitches),
            mean_launch_angle = weighted.mean(launch_angle, pitches)) %>% 
  mutate(ba = sum_hits / sum_abs,
         swing_percentage = sum_swings / pitch_count,
         whiff_percentage = sum_whiffs / sum_swings,
         contact_rate = (sum_swings - sum_whiffs) / sum_swings,
         take_percentage = sum_takes / pitch_count)

# calc stats for all recorded data
master_allyears_summary <- master_pitch_usage_aggregate %>% 
  group_by(year, pitch) %>% 
  filter(total_pitches > 100) %>%
  select(-c(player_name, total_pitches, pitch_percent, ba,
            spin_rate, release_extension, effective_speed, eff_min_vel,
            xwoba, xba, launch_speed, launch_angle)) %>% 
  drop_na() %>% 
  summarise(pitch_count = sum(pitches),
            sum_whiffs = sum(whiffs),
            sum_swings = sum(swings),
            sum_takes = sum(takes),
            sum_abs = sum(abs),
            sum_hits = sum(hits),
            mean_velocity = weighted.mean(velocity, pitches),
            mean_iso = weighted.mean(iso, pitches),
            mean_babip = weighted.mean(babip, pitches),
            mean_slg = weighted.mean(slg, pitches),
            mean_woba = weighted.mean(woba, pitches)) %>% 
  mutate(ba = sum_hits / sum_abs,
         swing_percentage = sum_swings / pitch_count,
         whiff_percentage = sum_whiffs / sum_swings,
         contact_rate = (sum_swings - sum_whiffs) / sum_swings,
         take_percentage = sum_takes / pitch_count)

# write .csv
write.csv(master_allyears_summary,
          "Data/Pitch Usage/Statistics/master_allyears_summary.csv",
          row.names = TRUE)

```

Bleh. Ok, now the fun stuff. Next, I took the total number of times each pitch type was thrown and divided it by the total number of thrown pitches to calculate pitch usage percentages. I did this for each year that basic pitch tracking data is available (2008 onwards).

```{r pitch usage over time, echo = FALSE, message = FALSE, warning = FALSE}

library(ggplot2)
library(ggpubr)

pitch_usage_plot <- ggplot(data = master_pitch_usage_percentages,
                           mapping = aes(x = year,
                                         y = pitch_usage,
                                         group = pitch)) +
  geom_point(aes(color = pitch)) +
  geom_line(aes(color = pitch)) +
  theme_minimal() +
  theme(legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        plot.title = element_text(hjust = 0.5)) +
  labs(x = "Season",
       y = "Percentage of Pitches Thrown",
       color = "Pitch")

pitch_usage_text <- paste("Figure 1: The percentage of total pitches throw for each pitch type",
                          "was plotted over time. Availability of pitch usage data began in 2008",
                          "via PITCHf/x. All data was obtained via Baseball Savant.",
                          sep = " ")

pitch_usage_para <- ggparagraph(text = pitch_usage_text,
                                size = 10,
                                color = "black")

final_pitch_usage_plot <- ggarrange(pitch_usage_plot,
                                    pitch_usage_para,
                                    ncol = 1,
                                    nrow = 2,
                                    heights = c(1, 0.3))

final_pitch_usage_plot

```

A few things jump out. Usage of the fastball has varied a bit, relative to other pitches, over time. But its usage has decreased overall. Usage of the sinker has decreased substantially. Usage of the change up and curveball increased marginally, while usage of the slider has visibly increased within the Statcast era.

Usage of the slider has increased substantially. SUBSTANTIALLY. This validates my anecdotal observations that its usage has increased. I'm a genius. Interestingly, usage has primarily increased since around 2016. Any ideas what this timeline aligns with? Whoa, you're right! This aligns very well with the availability of advanced pitch metrics compiled by the Statcast systems installed in 2015. Perhaps slider usage increased in response to the addition of Statcast data that either suggested its effectiveness or indicated ways to maximize its potential.

```{r pitch usage change table, echo = FALSE, message = FALSE, results = TRUE}

library(scales) # percentages
library(reactablefmtr) # pretty tables

pitch_percentage_change_function <- function(start_year, end_year) {
  
  library(scales) # percentages
  library(reactablefmtr) # pretty tables
  
  pitch_percentage_changes <- master_pitch_usage_percentages %>% 
    filter(between(year, start_year, end_year)) %>% 
    group_by(pitch) %>% 
    mutate(usage_change = pitch_usage - pitch_usage[1]) %>% 
    mutate(usage_change_percent = (pitch_usage / pitch_usage[1])-1) %>%
    filter(year == end_year)
  
  pitch_percentage_changes_table <- pitch_percentage_changes %>% 
    select(pitch, usage_change_percent) %>% 
    rename("Pitch" = pitch,
           'Percent Change' = usage_change_percent) %>% 
    as.data.frame()

  pitch_percentage_changes_table <- reactable(
  pitch_percentage_changes_table,
  pagination = FALSE,
  defaultSorted = 'Percent Change',
  defaultSortOrder = "asc",
  columns = (list(Pitch = colDef(width = 100),
                  'Percent Change' = colDef(width = 200,
                                    align = "center"))),
  defaultColDef = colDef(cell = data_bars(pitch_percentage_changes_table,
                                          number_fmt = scales::percent,
                                          max_value = 1,
                                          text_position = "outside-end",
                                          fill_color = c("red", "blue"))))
  
  return(pitch_percentage_changes_table)
  
}

pitch_percentage_change_2015to2022 <- pitch_percentage_change_function(2015, 2022) %>% 
  add_subtitle("Change in Pitch Usage: 2015-2022",
               font_weight = "normal")

pitch_percentage_change_2015to2022

```

Quantification of these usage changes reveals that slider usage has increased by 43% since Statcast data became available. Usage of the cutter also increased substantially, but initial usage was low relative to the slider so raw pitch numbers are also relative low. Interesting, the slider and cutter both have similar speeds and movement trajectories, with the slider having greater movement. I wonder if the uptick in usage of both of these pitches is connected. But that's an analysis for another day.

### Slider Pitch Outcomes

Now I need to figure out why usage of the slider has increased so much. Fortunately, all of the available pitch factor outcome data exists within the data I have already downloaded.

First, I plotted the percentage of pitches that hitters swung at and the rate at which those swings resulted in contact.

```{r master file for statcast stats, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}

# trim down data to include only Statcast era and pitchers with < 100 pitches
master_statcast_aggregate <- master_pitch_usage_aggregate %>% 
  filter(year > 2014,
         total_pitches > 99) %>% 
  mutate(whiff_percentage = whiffs / swings)

```

```{r swings and contact plots, echo = FALSE, message = FALSE, results = TRUE}

swing_plot <- ggplot(data = master_allyears_summary,
                     mapping = aes(x = year,
                                   y = swing_percentage,
                                   group = pitch)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1, size = 8)) +
  labs(title = "Swing Rate by Pitch",
       y = "Swing Rate",
       x = "Season",
       color = "Pitch")

contact_plot <- ggplot(data = master_allyears_summary,
                       mapping = aes(x = year,
                                     y = contact_rate,
                                     group = pitch)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1, size = 8)) +
  labs(title = "Contact Rate by Pitch",
       y = "Contact Rate",
       x = "Season",
       color = "Pitch")

swing_contact_plot <- ggarrange(swing_plot,
                                contact_plot,
                                ncol = 2,
                                nrow = 1,
                                common.legend = TRUE,
                                legend = "right")

swing_contact_text <- paste("Figure 2: The percentage of swings per total pitches throw for each pitch type",
                            "and the percentage of swings that resulted in contact were plotted over time.",
                            "Availability of pitch usage data began in 2008 via PITCHf/x. All data was",
                            "obtained via Baseball Savant.",
                            sep = " ")

swing_contact_para <- ggparagraph(text = swing_contact_text,
                                  size = 10,
                                  color = "black")

final_swing_contact_plot <- ggarrange(swing_contact_plot,
                                     swing_contact_para,
                                     ncol = 1,
                                     nrow = 2,
                                     heights = c(1, 0.3))

final_swing_contact_plot

```

Sliders are one of the pitches that batters swing most often at, with hitters swinging at only change ups and cutters more often. However, hitters make contact less often on sliders than any other pitch. From a pitcher strategy position, the best outcome is for a hitter to whiff when they swing. Perhaps sliders provide a way to maximize whiffs, as hitters swing at them more often than most pitches and make contact less often than any other pitch.

While I am focusing on sliders moving forward, there are a lot of interesting follow-up analyses that can stem from these swing and contact rate results. I'm going to spit-ball a couple here before moving on with slider analyses.

Sinker contact rate is quite high relative to other pitches. In a vacuum, contact is a negative pitcher outcome because it creates an opportunity for the hitter to reach base and potentially score a run. So in that same vacuum, the sinker is likely not a good pitch because it leads to more opportunities for hitters to reach base. Unless the contact against sinkers sucks. The sinker has historically been used to induce groundballs, which can lead to easy players for infielders to produce outs or double plays. A future analysis could look at the association between sinkers and hitter launch angle, as well as the pitch factors that decrease launch angle to produce ground balls.

Change ups are also thrown often and result in low contact rates. An analysis similar to the one I have planned for the slider could be quite interesting for this pitch as well.

Furthermore, there has been a general downtrend in contact rate across all pitches with time. This aligns well with the narrative that baseball has shifted towards an offensive approach model of [Three True Outcomes](https://www.mlb.com/glossary/idioms/three-true-outcomes). I would be curious at seeing if contact rate is associated with swing plane and swing angle, as hitting philosophy has shifted more towards [increasing launch angle](https://www.washingtonpost.com/graphics/sports/mlb-launch-angles-story/) in recent years.

OK. Back to the slider. So hitters are swing at sliders a lot *and* whiffing against them more often than any other pitch. But what happens when hitters do make contact? If that contact is good, resulting in more hits, the benefit of inducing whiffs might be lost.

```{r batting average plots, echo = FALSE, message = FALSE, results = TRUE}

ba_plot <- ggplot(data = master_statcast_summary,
                  mapping = aes(x = year,
                                y = ba,
                                group = pitch)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(y = "Batting Average",
       x = "Season",
       color = "Pitch")

xba_plot <- ggplot(data = master_statcast_summary,
                  mapping = aes(x = year,
                                y = mean_xba,
                                group = pitch)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(y = "Expected Batting Average",
       x = "Season",
       color = "Pitch")

babip_plot <- ggplot(data = master_statcast_summary,
                     mapping = aes(x = year,
                                   y = mean_babip,
                                   group = pitch)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45)) +
  labs(y = "BABIP",
       x = "Season",
       color = "Pitch")

batting_averages_plot <- ggarrange(ba_plot,
                                   xba_plot,
                                   babip_plot,
                                   ncol = 3,
                                   nrow = 1,
                                   common.legend = TRUE,
                                   legend = "right")

ba_text <- paste("Figure 3: Batting average, expected batting average, and batting",
                 "average on balls in play (BABIP) were plotted over time. Batting average",
                 "was calculated by dividing the number of hits against each pitch by",
                 "the number of at bats. Expected batting average and BABIP were calculated",
                 "as the mean across all pitchers weighted by the number of pitches thrown",
                 "per pitch type. All available data was obtained via Baseball",
                  "Savant and included.")

ba_para <- ggparagraph(text = ba_text,
                       size = 10,
                       color = "black")

final_ba_plot <- ggarrange(swing_contact_plot,
                           ba_para,
                           ncol = 1,
                           nrow = 2,
                           heights = c(1, 0.3))

final_ba_plot

```

Note: for these analyses, I've reduced that dataset down to Statcast-era data, as this contains the most advanced metrics.

When hitters do make contact, they produce a lower batting average (i.e., average number of hits per at bat, with a batting average of 0.500 indicating one hit per every two at bats) against sliders than all other pitches. The same goes for expected batting average, which considers the likelihood that a given contact will result in a hit based on the batted ball trajectory. When you look at batting average on balls in play (BABIP), which removes strikeouts from the equation, the only pitch that routinely outperforms the slider os the change up.

From BABIP and batting average, we can reverse calculate the strikeout rates for each pitch (because the only difference between BABIP and batting average is the strikeouts are not considered in BABIP).

```{r strikeouts table, echo = FALSE, message = FALSE, results = TRUE}

strikeout_rate_table <- master_statcast_summary %>% 
  mutate(strikeout_rate = mean_babip - ba) %>% 
  select(year, pitch, strikeout_rate) %>% 
  pivot_wider(names_from = year,
              values_from = strikeout_rate)

strikeout_rate_table <- reactable(strikeout_rate_table,
                                  pagination = FALSE,
                                  defaultColDef = colDef(cell = data_bars(strikeout_rate_table,
                                                                          number_fmt = scales::percent,
                                                                          text_position = "above",
                                                                          round_edges = TRUE,
                                                                          max_value = 0.1,
                                                                          fill_color = "red")))
  
strikeout_rate_table

```

From this, it is clear that hitters strikeout against sliders more than most other pitches, with only the curveball competing (and slightly outperforming some years).

What if the contact that hitters do make against sliders is really good? What if that contact leads to more extra-base hits, such as doubles, triples, and home runs, compared to other pitches?

```{r slugging and iso plots, echo = FALSE, message = FALSE, results = TRUE}

slg_plot <- ggplot(data = master_statcast_summary,
                     mapping = aes(x = year,
                                   y = mean_slg,
                                   group = pitch)) +
  geom_point(aes(color = pitch)) +
  geom_line(aes(color = pitch)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(title = "Slg. Percentage by Pitch",
       x = "Season",
       y = "Slugging Percentage",
       color = "Pitch")

exit_velo_plot <- ggplot(data = master_statcast_summary,
                         mapping = aes(x = year,
                                       group = pitch,
                                       y = mean_launch_speed)) +
  geom_line(aes(color = pitch)) +
  geom_point(aes(color = pitch)) +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(title = "Exit Velo. By Pitch",
       x = "Season",
       y = "Exit Velocity (mph)",
       color = "Pitch")


slg_exitvelo_plot <- ggarrange(slg_plot,
                               exit_velo_plot,
                               ncol = 2,
                               nrow = 1,
                               common.legend = TRUE,
                               legend = "right")
slg_exitvelo_plot

power_text <- paste("Figure 4: Slugging and exit velocity were calculated as the",
                    "mean across all pitches weighted by the number of pitches thrown",
                    "per pitch type. All available data was obtained via Baseball",
                    "Savant and included.")

power_para <- ggparagraph(text = power_text,
                          size = 10,
                          color = "black")

final_power_plot <- ggarrange(slg_exitvelo_plot,
                              power_para,
                              ncol = 1,
                              nrow = 2,
                              heights = c(1, 0.3))

final_power_plot

```

Well, that's not the case. Slugging percentage, which is a calculation of the average number of total bases per at bat (for example, one single in four at bats yields a slugging percentage of 0.250), is typically lower against sliders than any other pitch.

To corroborate this, we can see that exit velocity, or the velocity of the ball towards the field when the hitter makes contact, is lower against sliders than most pitches. Only the change up results in a lower exit velocity. (Hmm...that change up is looking more and more enticing for future analysis).

So from all of these outcome analyses, we can conclude the following:

-   Sliders yield more swings than most other pitches
-   Sliders yield more whiffs than any other pitch
-   Sliders yield lower batting averages and expected batting averages
-   Sliders yield lower BABIPs than any pitch except the change up
-   Sliders yield more strikeouts than any pitch except the curveball
-   Sliders yield a lower slugging percentage than any other pitch.
-   Sliders yield softer contact than any pitch except the change up

Sliders are dominant.

### Predictors of Pitch

What about the slider makes it so effective at inducing whiffs and weak contact? Publicly available metrics that we can consider are velocity, spin rate, release extension, different types of movement, and location in the zone. Because looking at both whiffs and weak contact would be a lot of work, let's start by looking at whiffs.

To obtain location data from [Baseball Savant's Statcast Search](https://baseballsavant.mlb.com/statcast_search), I filtered and downloaded available pitch usage and outcome data by zone per year, for each pitch. Zones encompassed 13 regions: the top left, top center, top right, middle left, middle center, middle right, bottom left, bottom center, and bottom right nonants inside of the strike zone; top left, top right, bottom left, and bottom right quadrants outside of the strike zone. Movement data was obtained through [Baseball Savant's Pitch Movement Leaderboard](https://baseballsavant.mlb.com/leaderboard/pitch-movement?year=2022&team=&min=q&pitch_type=ALL&hand=&x=diff_x_hidden&z=diff_z_hidden) and was filtered by slider and downloaded by year. Again, all pitcher and batter handedness-es were grouped together and only pichers that threw at least 100 pitches in a year were included. The available movement data is not differentiated by pitch location, limiting the accuracy of interaction analyses between the two variables.

```{r slider location data aggregation, echo = FALSE, message = FALSE, results = FALSE}

slider_location_aggregate_function <- function(slider_location_files_path) {

slider_location_aggregate <- rbindlist(mapply(c,(list.files(path = slider_location_files_path,
                                                            pattern = "*.csv",
                                                            full.names = TRUE) %>%
                                                   lapply(read.table,
                                                          header = TRUE,
                                                          sep = ",",
                                                          encoding = "UTF-8")),
                                              (list.files(path = slider_location_files_path,
                                                          pattern = "*.csv",
                                                          full.names = TRUE) %>%
                                                 basename() %>%
                                                 as.list()),
                                              SIMPLIFY = FALSE),
                                       fill = T) %>%
  mutate(year = substr(V1, 1, 4)) %>% # pull year from col V1
  mutate(pitch = substr(V1, 14, 19)) %>% # pull pitch abr from col V1
  mutate(zone = substr(V1, 11, 12)) %>% # pull zone from col V1
  select(-c(pos3_int_start_distance, pos4_int_start_distance,
            pos5_int_start_distance, pos6_int_start_distance,
            pos7_int_start_distance, pos8_int_start_distance,
            pos9_int_start_distance, V1)) %>% # remove select cols
  select(player_name, player_id, year:pitch, zone, pitches:pitch_percent, spin_rate:velocity,
         release_extension, effective_speed, eff_min_vel, ba:launch_angle,
         whiffs:takes) # reorder cols
return(as.data.frame(slider_location_aggregate))
}

# set paths to pitch files
slider_location_all_path <- "Data/Location/Slider/All"

# aggregate movement files into dfs
slider_location_all_aggregate <- slider_location_aggregate_function(slider_location_all_path)

# write master df to .csv file
write.csv(slider_location_all_aggregate,
          "Data/Location/Slider/All/Aggregate Files/master_slider_location_all_aggregate.csv",
          row.names = TRUE)

```

Let's first look at the influence of slider velocity on whiff likelihood. The distance from the pitcher's mound to home plate is 60.5 feet. A slider thrown 80 mph travels 117.3 feet per second (fps), while a slider thrown 90 mph travels 132 fps. So when a slider is thrown 80 mph, a hitter has 0.516 seconds to identify what pitch is being thrown, decide whether or not that pitch will be in the strike zone, determine whether to swing, and execute that swing. Conversely, a hitter has only 0.458 seconds when a slider is thrown 90 mph.

```{r pitch velocity, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

velocity_whiffs_plot <- ggplot(data = master_statcast_aggregate,
                               mapping = aes(x = velocity,
                                             y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Velocity (mph)",
       y = "Whiffs (%)",
       color = "Pitch")

velo_text <- paste("Figure 5: The percentage of swings resulting in a whiff was",
                   "plotted by velocity per pitch type. Velocity was calculated as",
                   "the mean across all pitchers weighted by the total pitches thrown",
                   "per pitch type. All available data was obtained via Baseball",
                   "Savant and included.")

velo_para <- ggparagraph(text = velo_text,
                         size = 10,
                         color = "black")

final_velo_plot <- ggarrange(velocity_whiffs_plot,
                             velo_para,
                             ncol = 1,
                             nrow = 2,
                             heights = c(1, 0.3))

final_velo_plot

```

An increase in velocity is generally associated with an increase in the percent of swings that result in a whiff (i.e., the whiff percentage). Except for the change up. This correlation is small-ish for the slider compared to other pitches like the fastball and curveball.

What about release extension? Release extension is defined as the distance the pitch is released from the pitcher's mound, and may influence the hitter's reaction window by shortening the distance that the pitch has to travel. For example, a release extension of 5 feet reduces the pitch travel distance from 60.5 feet to 55.5 feet. So, an 90 mph slider thrown with 0 feet of release extension travels to home plate in 0.458 seconds while an 80 mph slider thrown with 5 feet of release extension travels to home plate in 0.42 seconds.

```{r release vs whiff rate, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

release_whiffs_plot <- ggplot(data = master_statcast_aggregate,
                              mapping = aes(x = release_extension,
                                            y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Release Extension (ft)",
       y = "Whiffs (%)",
       color = "Pitch")

release_text <- paste("Figure 6: The percentage of swings resulting in a whiff was",
                      "plotted by release extension per pitch type. Release extension was",
                      "calculated as the mean across all pitchers weighted by the total",
                      "pitches thrown per pitch type. All available data was obtained",
                      "via Baseball Savant and included.")

release_para <- ggparagraph(text = release_text,
                            size = 10,
                            color = "black")

final_release_plot <- ggarrange(release_whiffs_plot,
                                release_para,
                                ncol = 1,
                                nrow = 2,
                                heights = c(1, 0.3))

final_release_plot

```

Release extension is also positively correlated with whiff percentage across all pitches, though this is somewhat marginal for the slider. So it seems that factors that reduce the reaction window for hitters likely aren't what's driving the effectiveness of a slider.

Spin rate might influence the hitter's ability to determine which pitch is being thrown. For example, faster spin rates may prevent the hitter from detecting the rotation of the spin rotation, which is indicative of how the pitch will move. Preventing the hitter from appropriately predicting pitch movement may increase likelihood of whiffs.

```{r spin rate vs whiff rate, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

spin_whiffs_plot <- ggplot(data = master_statcast_aggregate,
                           mapping = aes(x = spin_rate,
                                         y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Spin Rate (rpm)",
       y = "Whiffs (%)",
       color = "Pitch")

spin_text <- paste("Figure 7: The percentage of swings resulting in a whiff was",
                   "plotted by spin rate per pitch type. Spin rate was calculated as",
                   "the mean across all pitchers weighted by the total pitches thrown",
                   "per pitch type. All available data was obtained via Baseball",
                   "Savant and included.")

spin_para <- ggparagraph(text = spin_text,
                         size = 10,
                         color = "black")

final_spin_plot <- ggarrange(spin_whiffs_plot,
                             spin_para,
                             ncol = 1,
                             nrow = 2,
                             heights = c(1, 0.3))

final_spin_plot

```

Spin rate does correlate to increases in whiff percent for all pitches, and the correlation appears to be greater here for sliders than that with velocity or release extension.

Next we can look at pitch movement. Publicly available pitch movement data includes horizontal movement (left to right or right to left), vertical movement due downward, rising movement, and tailing movement (movement opposite to horizontal movement, usually small in scale). Sliders typically rise, then move both horizontally and vertically with minimal tail. Let's see how those influence whiff outcomes.

```{r pitch movement data aggregation, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}

pitch_move_aggregate_function <- function(pitch_move_files_path) {
  
pitch_move_aggregate <- rbindlist(mapply(c,(list.files(path = pitch_move_files_path,
                                                       pattern = "*.csv",
                                                       full.names = TRUE) %>%
                                              lapply(read.table,
                                                     header = TRUE,
                                                     sep = ",",
                                                     encoding = "UTF-8")),
                                         (list.files(path = pitch_move_files_path,
                                                     pattern = "*.csv",
                                                     full.names = TRUE) %>%
                                            basename() %>%
                                            as.list()),
                                         SIMPLIFY = FALSE),
                                  fill = T) %>%
  mutate(pitch = recode(pitch_type_name, Changeup = 'Change', '4-Seamer' = "Fastball")) %>%
  mutate(player_id = pitcher_id,
         horizontal_break = pitcher_break_x,
         vertical_break = pitcher_break_z) %>% 
  select(-V1) %>% # remove select cols
  select(year, player_id, last_name, first_name, pitch_hand, 
         total_pitches, pitch, pitches_thrown,
         avg_speed, rise, tail, horizontal_break, vertical_break) # reorder cols

return(as.data.frame(pitch_move_aggregate))
}

# set paths to pitch files
all_move_path <- "Data/Movement/All Pitches"

# aggregate movement files into dfs

all_move_aggregate <- pitch_move_aggregate_function(all_move_path)

# write master df to .csv file
write.csv(all_move_aggregate,
          "Data/Movement/All Pitches/master_pitch_movement_aggregate.csv",
          row.names = TRUE)

# Now merge movement data with other Statcast data

# format movement data
all_move_aggregate <- all_move_aggregate %>% 
  group_by(player_id, year, pitch) %>% 
  mutate(year = as.character(year))

# format statcast data and merge with movement data
statcast_move_aggregate <- master_statcast_aggregate %>% 
  group_by(player_id, year, pitch) %>% 
  inner_join(all_move_aggregate,
             by = c('player_id' = 'player_id',
                    'year' = 'year',
                    'pitch' = 'pitch')) %>% 
  select(-c(last_name, first_name, total_pitches.y, pitches_thrown, avg_speed)) %>% 
  rename(total_pitches = total_pitches.x) %>% 
  select(player_id, player_name, pitch_hand, year:whiff_percentage, rise:vertical_break)

# write .csv file
write.csv(statcast_move_aggregate,
          "Data/Key Aggregates/Statcast and Movement Data.csv",
          row.names = TRUE)

```

```{r horizontal break vs whiffs, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

horbreaks_whiffs_plot <- ggplot(data = statcast_move_aggregate,
                                mapping = aes(x = horizontal_break,
                                              y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Horizontal Break (in)",
       y = "Whiffs (%)",
       color = "Pitch")

horizontal_text <- paste("Figure 8: The percentage of swings resulting in a whiff was",
                         "plotted by horizontal movement per pitch type. Horizontal",
                         "movement was calculated as the mean across all pitchers weighted",
                         "by the total pitches thrown per pitch type. All available",
                         "data was obtained via Baseball Savant and included.")

horizontal_para <- ggparagraph(text = horizontal_text,
                               size = 10,
                               color = "black")

final_horizontal_plot <- ggarrange(horbreaks_whiffs_plot,
                                   horizontal_para,
                                   ncol = 1,
                                   nrow = 2,
                                   heights = c(1, 0.3))

horbreaks_whiffs_plot

```

Horizontal movement is positively correlated to whiff percentage for sliders, though this correlation is marginal. This is also the case for change ups, curveballs, and fastballs. Horizontal movement exhibits a large positive correlation with whiff likelihood for cutters and a negative correlation for sinkers.

```{r vertical break vs whiffs, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

verbreaks_whiffs_plot <- ggplot(data = statcast_move_aggregate,
                                mapping = aes(x = vertical_break,
                                              y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Vertical Break (in)",
       y = "Whiffs (%)",
       color = "Pitch")

vertical_text <- paste("Figure 9: The percentage of swings resulting in a whiff was",
                       "plotted by vertical break per pitch type. Vertical break was",
                       "calculated as the mean across all pitchers weighted by the",
                       "total pitches thrown per pitch type. All available data was",
                       "obtained via Baseball Savant and included.")

vertical_para <- ggparagraph(text = vertical_text,
                             size = 10,
                             color = "black")

final_vertical_plot <- ggarrange(verbreaks_whiffs_plot,
                                 vertical_para,
                                 ncol = 1,
                                 nrow = 2,
                                 heights = c(1, 0.3))

final_vertical_plot

```

Vertical break has a stronger positively correlation with slider whiff likelihood than horizontal break. It is also positively correlationed with whiff likelihood for change ups and cutters, while being negatively correlated for curveballs, fastballs, and sinkers.

```{r rise vs whiffs, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

rise_whiffs_plot <- ggplot(data = statcast_move_aggregate,
                           mapping = aes(x = rise,
                                         y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  facet_wrap(vars(pitch)) +
  labs(x = "Rise (in)",
       y = "Whiffs (%)",
       color = "Pitch")

rise_text <- paste("Figure 10: The percentage of swings resulting in a whiff was",
                   "plotted by rising movement per pitch type. Rise was calculated as",
                   "the mean across all pitchers weighted by the total pitches thrown",
                   "per pitch type. All available data was obtained via Baseball",
                   "Savant and included.")

rise_para <- ggparagraph(text = rise_text,
                         size = 10,
                         color = "black")

final_rise_plot <- ggarrange(rise_whiffs_plot,
                             rise_para,
                             ncol = 1,
                             nrow = 2,
                             heights = c(1, 0.3))

final_rise_plot

```

An increase in rise has a clear positive correlation with whiff likelihood. It is also positively correlated with whiff likelihood for change ups and fastballs, but is negatively correlated for curveballs, cutters, and sinkers.

```{r tail vs whiffs, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

tail_whiffs_plot <- ggplot(data = statcast_move_aggregate,
                           mapping = aes(x = tail,
                                         y = whiff_percentage)) +
  geom_point(aes(color = pitch)) +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  xlim(-250, 250) +
  facet_wrap(vars(pitch)) +
  labs(x = "Tail (in)",
       y = "Whiffs (%)",
       color = "Pitch")

tail_text <- paste("Figure 11: The percentage of swings resulting in a whiff was",
                   "plotted by tailing movement per pitch type. Tail was calculated as",
                   "the mean across all pitchers weighted by the total pitches thrown",
                   "per pitch type. All available data was obtained via Baseball",
                   "Savant and included.")

tail_para <- ggparagraph(text = tail_text,
                         size = 10,
                         color = "black")

final_tail_plot <- ggarrange(tail_whiffs_plot,
                             tail_para,
                             ncol = 1,
                             nrow = 2,
                             heights = c(1, 0.3))

final_tail_plot

```

Tailing movement is positively correlated with whiff likelihood for for sliders. It's actually positively correlated with whiff likelihood for every pitch except the sinker.

The last variable we can consider is pitch location in the strike zone.

```{r slider location, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

slider_location_all_aggregate <- slider_location_all_aggregate %>%
  mutate(whiff_percentage = whiffs / swings) %>% 
  mutate(zone = recode(zone, 
                       '01' = 'Top Left', '02' = 'Top Center', '03' = 'Top Right',
                       '04' = 'Middle Left', '05' = 'Middle Center', '06' = 'Middle Right',
                       '07' = 'Bottom Left', '08' = 'Bottom Center', '09' = 'Bottom Right',
                       '10' = 'Outside Top Left', '12' = 'Outside Top Right',
                       '13' = 'Outside Bottom Left', '14' = 'Outside Bottom Right'))

slider_zone_plot <- ggplot(data = slider_location_all_aggregate,
                           mapping = aes(x = factor(zone,
                                                    level = c("Outside Top Left", 
                                                              "Outside Top Right",
                                                              "Top Left",
                                                              "Top Center",
                                                              "Top Right",
                                                              "Middle Left",
                                                              "Middle Center",
                                                              "Middle Right",
                                                              "Bottom Left",
                                                              "Bottom Center",
                                                              "Bottom Right",
                                                              "Outside Bottom Left",
                                                              "Outside Bottom Right")),
                                         y = whiff_percentage)) +
  geom_point(alpha = 0.1) +
  geom_jitter(alpha = 0.1) +
  stat_summary(geom = "point",fun.y = "mean",
               col = "red", fill = "red",
               size = 5, shape = 19, alpha = 1) +
  stat_summary(fun.data = mean_se, geom = "errorbar",
               col = "red", fill = "red", alpha = 1) +
  theme_minimal() +
  theme(legend.box.background = element_rect(colour = "black"),
        legend.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Location in Strike Zone",
       y = "Whiffs (%)",
       color = "Zone")

location_text <- paste("Figure 12: The percentage of swings resulting in a whiff was",
                   "plotted by strike zone location per pitch type. Location was",
                   "divided into nonants inside the zone and quadrants outside",
                   "the zone. All available data was obtained via Baseball",
                   "Savant and included.")

location_para <- ggparagraph(text = location_text,
                             size = 10,
                             color = "black")

final_location_plot <- ggarrange(slider_zone_plot,
                                 location_para,
                                 ncol = 1,
                                 nrow = 2,
                                 heights = c(1, 0.3))

final_location_plot

```

Throwing a slider in the middle of strike zone leads to fewer whiffs. No surprises here. Whiff likelihood is higher as you throw pitches either high or low in the zone. However, whiff likelihood is highest when you throw a pitch outside of the zone, particularly below the zone and to the right.

Let's summarize everything we know about the slider so far.

```{r slider total image, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

statcast_slider_move_df <- statcast_move_aggregate %>% 
  filter(pitch == "Slider")

slider_velo_plot <- ggplot(data = statcast_slider_move_df,
                               mapping = aes(x = velocity,
                                             y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Velocity (mph)",
       y = "Whiffs (%)")

slider_spin_plot <- ggplot(data = statcast_slider_move_df,
                               mapping = aes(x = spin_rate,
                                             y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Spin Rate (rpm)",
       y = "Whiffs (%)")

slider_release_plot <- ggplot(data = statcast_slider_move_df,
                              mapping = aes(x = release_extension,
                                            y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Release Extension (ft)",
       y = "Whiffs (%)")

slider_horizontal_plot <- ggplot(data = statcast_slider_move_df,
                                 mapping = aes(x = horizontal_break,
                                               y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Horizontal Break (in)",
       y = "Whiffs (%)")

slider_vertical_plot <- ggplot(data = statcast_slider_move_df,
                               mapping = aes(x = vertical_break,
                                             y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Vertical Break (in)",
       y = "Whiffs (%)")

slider_tail_plot <- ggplot(data = statcast_slider_move_df,
                           mapping = aes(x = tail,
                                         y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Tail (in)",
       y = "Whiffs (%)")

slider_rise_plot <- ggplot(data = statcast_slider_move_df,
                           mapping = aes(x = rise,
                                         y = whiff_percentage)) +
  geom_point(color = "magenta") +
  geom_smooth(method = "lm",
              se = FALSE,
              fullrange = TRUE,
              color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(x = "Rise (in)",
       y = "Whiffs (%)")

slider_factor_plot <- ggarrange(slider_velo_plot, slider_spin_plot, slider_release_plot,
                                slider_horizontal_plot, slider_vertical_plot,
                                slider_rise_plot, slider_tail_plot,
                                ncol = 3,
                                nrow = 3)
slider_all_text <- paste("Figure 13: The percentage of swings resulting in a whiff was",
                         "plotted for each slider pitch factor. All available data was",
                         "obtained via Baseball Savant and included.")

slider_all_para <- ggparagraph(text = slider_all_text,
                               size = 10,
                               color = "black")

final_slider_all_plot <- ggarrange(slider_factor_plot,
                                   slider_all_para,
                                   ncol = 1,
                                   nrow = 2,
                                   heights = c(1, 0.3))

final_slider_all_plot

```

All of the considered variables led to increased whiff likelihood against sliders. While I had anticipated that velocity and horizontal and vertical movement would be associated with the greatest increase in whiff likelihood, spin rate, rise and tail had the greatest influence.

### Modeling the Predictors of Whiff Likelihood

Let's construct a linear regression model using velocity, release extension, spin rate, movement, and location as predictors of whiff likelihood. Modeling these factors will help characterize the relationship and strength of the associations.

There's quite a bit of variance in sample size (number of pitches per location in the strike zone) across players per year. Let's filter out samples with fewer than 10 pitches per location to remove the influence of small sample sizes.

```{r model data aggregation, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}

# aggregate all statcast statistics, movement data, and location data
# keep only the entries that have ALL of this data
# filter out samples with fewer than 10 swings per zone to avoid small sample size influences

slider_move_aggregate <- all_move_aggregate %>% 
  filter(pitch == 'Slider') %>% # keep only slider
  group_by(player_id, year)

slider_move_location_stats_aggregate <- slider_location_all_aggregate %>% 
  group_by(player_id, year, zone) %>% 
  inner_join(slider_move_aggregate,
             by = c('player_id' = 'player_id',
                    'year' = 'year',
                    'pitch' = 'pitch')) %>% 
  select(-c(last_name, first_name, 
            total_pitches.y, pitches_thrown, avg_speed)) %>% 
  rename(total_pitches = total_pitches.x) %>% 
  select(player_id, player_name, pitch_hand, pitch, year, zone,
         total_pitches, rise:vertical_break, spin_rate:whiff_percentage) %>% 
  filter(swings > 9) %>% # remove tiny sample sizes
  mutate(rise = as.numeric(rise),
         tail = as.numeric(tail),
         spin_rate = as.numeric(spin_rate))

slider_move_location_stats_select <- slider_move_location_stats_aggregate %>% 
  select(velocity, spin_rate, release_extension, horizontal_break, vertical_break,
         rise, tail, zone, whiffs, swings) %>% 
  drop_na()

```

There are several factors to consider in constructing a model here.
-   Whiffs are a counting statistic, so a Poisson distribution parameter is needed for the model
-   The canonical link of the Poisson distribution is logarithmic
-   There is a mixture of predictor variable classes (e.g., 'whiffs' is an integer, movement statistics are numerics, and location is a 'character), so a generalized linear model is needed
-   The sample size of swings against the slider varies substantially across players and strike zone locations. This can be scaled by applying the offset() function to the log('swings')

```{r model packages, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}

library(performance)

```

```{r glm model, echo = TRUE, message = FALSE, warning = FALSE, results = FALSE}

slider_whiff_glm <- glm(whiffs ~ velocity + spin_rate + 
                        release_extension + horizontal_break + vertical_break 
                        + rise + tail + zone + offset(log(swings)),
                        family = poisson(link = "log"),
                        data = slider_move_location_stats_select)

```

```{r glmm model assumption check, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

check_model(slider_whiff_glm)

```

The posterior predictive check looks great - the model-predicted data mirrors the observed data nearly identically. There are no indicators of concern how homogeneity of variance, influential observations, and normality of residuals. However, there are clear concerns with overdispersion or zero-inflation and with co-linearity. I'll first alter my model to a quasipoisson distribution family, which treats overdispersion as a nuissance parameter.

```{r quasipoisson model, echo = TRUE, message = FALSE, warning = FALSE, results = FALSE}

slider_whiff_glm <- glm(whiffs ~ velocity + spin_rate + 
                        release_extension + horizontal_break + vertical_break 
                        + rise + tail + zone + offset(log(swings)),
                        family = quasipoisson(link = "log"),
                        data = slider_move_location_stats_select)

```

Next I have to consider the possible co-linearity concerns. There is a moderate VIF for horizontal break and rise, as well as high VIF for velocity and vertical break. I am not SUPER concerned about this because the posterior predictive check is such a good match. It is worth looking at the correlation between predictors, though.

```{r var correlations, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

library(corrplot)

slider_move_location_p <- slider_move_location_stats_aggregate %>%
  as.data.frame() %>%
  mutate(spin_rate = as.numeric(spin_rate),
         release_extension = as.numeric(release_extension)) %>% 
  select(velocity, spin_rate, release_extension,
         horizontal_break, vertical_break, rise, tail) %>% 
  cor.mtest(conf.level = 0.95) # calculate correlation p-values

slider_corr_plot <- slider_move_location_stats_aggregate %>%
  as.data.frame() %>%  
  mutate(spin_rate = as.numeric(spin_rate),
         release_extension = as.numeric(release_extension)) %>% 
  select(velocity, spin_rate, release_extension,
         horizontal_break, vertical_break, rise, tail) %>% # select the variables
  as.matrix() %>%                   
  cor() %>% 
  corrplot(lower.col = "black",
           number.cex = 0.5,
           title = "\n\n Correlation Plot Of Whiff Likelihood Predictors \n",
           addCoef.col = "black",
           type = 'lower',
           p.mat = slider_move_location_p$p,
           method = 'circle',
           insig = 'blank',
           order = 'AOE',
           diag = FALSE)

slider_corr_text <- paste("Figure 14: The correlation between each pitch factor",
                          "was determined for sliders. All available data was",
                         "obtained via Baseball Savant and included.")

slider_corr_para <- ggparagraph(text = slider_corr_text,
                                size = 10,
                                color = "black")

final_slider_corr_plot <- ggarrange(slider_corr_plot,
                                    slider_corr_para,
                                    ncol = 1,
                                    nrow = 2,
                                    heights = c(1, 0.3))

final_slider_corr_plot

```

These results are interesting both in regard to the co-linearity concerns of my model and also in regards to baseball physics as a whole. Velocity has a strong negative correlation with a slider's horizontal and vertical break. Intuitively, it makes sense that more movement would decrease velocity by increasing friction and resistance exposure. However, it can't be determined from this whether increased velocity reduces movement or vice versa. 

Spin rate is correlated with all movement types. This aligns with modern pitching development approaches that emphasize increasing spin rate to improve pitch movement. In fact, there was a recent [MLB cheating scandal](https://www.mlb.com/news/updated-sticky-stuff-guidelines#:~:text=Any%20pitcher%20who%20possesses%20or,and%20pitcher%20will%20be%20ejected.) in which pitchers were caught using an illegal, sticky substance to increase grip and spin rate during games.

Lastly, all movement types are positively correlated with one another. This means that generally, increases in one type of movement are associated with increases in all type of movement. This may indicate that "movement" could be considered an overarching pitch factor comprised of individual metrics.

For the purpose of this linear model and analysis, I will not remove any of these co-linear variables. I will not look at interaction effects either, as this would result in 16 predictors in the model. Exporing interaction effects between velocity and horizontal and vertical breaks, spin rate and all movements, and all movements with each other will be an aim of follow-up analyses.

So what can we learn from this model?

```{r model R2, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

r2(slider_whiff_glm)

```

The model explains 97% of the variance in the data. That's excellent. So what does this model tell us about how these variables predict whiff likelihood?

```{r model coefs, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

whiff_model_coefs <- coef(summary(slider_whiff_glm)) %>% 
  as.data.frame() %>% 
  rename("Influence" = "Estimate",
         "T-Value" = "t value") %>% 
  select(c('Influence', 'Std. Error', 'T-Value')) %>% 
  signif(digits = 3) %>% 
  format(scientific = TRUE)

whiff_model_coefs_table <- reactable(whiff_model_coefs,
                                     pagination = FALSE,
                                     sortable = TRUE,
                                     defaultColDef = colDef(align = "center")) %>%
  add_title("Influence of Different Predictors on Whiff Likelihood",
            font_size = 28,
            align = "center")

whiff_model_coefs_table

```

Initial assessments of each predictor's influence indicates that rise and tail decrease whiff likelihood for sliders, as does throwing the slider in any nonant of the middle of the zone. Every other predictor increases whiff likelihood. Let's apply the model now to analyze the precise influence of each pitch factor on whiff likelihood. Let's also do some predictions.

```{r zone visreg, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

library(visreg) # for visualizing model
library(ggpubr) # for combining plotting objects

zone_visreg <- visreg(slider_whiff_glm,
                      "zone",
                      gg = TRUE,
                      line.par = list(col = "red",
                                      alpha = 1)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  labs(title = "Influence of Pitch Location",
       subtitle = "On Whiff Likelihood",
       x = "Pitch Location",
       y = "Whiff Ratio Relative to the Mean")

zone_visreg

```

Visualizing the influence of pitch location on whiff likelihood clearly exemplifies this. Throwing sliders in the middle of the zone result in the lowest whiff percentage relative to the mean. Throwing sliders in the top of the zone is slightly better, and throwing sliders low in the zone is even better. Pitches in the middle result in fewer fewer whiffs, while pitches in the right result in the most. Throwing pitches outside of the result leads to more whiffs than inside the zone, with pitches that are low and outside the zone resulting in the most whiffs. The best location to throw the slider in is low and outside the zone to the right side of the plate. These results are likely driven by the dominance of righty pitchers and righty hitters in this sample, meaning most sliders analyzed here move downward and away from righty batters.

```{r velo visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

library(visreg)
library(ggforce)
library(ggpubr)

velo_visreg_IBC <- visreg(slider_whiff_glm,
                          "velocity",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1, # this and ncol split plots into individual
                      page = 1) # this is the facet that will be plotted

velo_visreg_IBL <- visreg(slider_whiff_glm,
                          "velocity",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

velo_visreg_IBR <- visreg(slider_whiff_glm,
                          "velocity",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

velo_visreg_IMC <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

velo_visreg_IML <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

velo_visreg_IMR <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

velo_visreg_ITC <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

velo_visreg_ITL <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

velo_visreg_ITR <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

library(grid)

velo_visreg_inside <- ggarrange(velo_visreg_ITL, velo_visreg_ITC, 
                                velo_visreg_ITR, velo_visreg_IML, 
                                velo_visreg_IMC, velo_visreg_IMR,
                                velo_visreg_IBL, velo_visreg_IBC,
                                velo_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>%
  annotate_figure(left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Velocity (mph)", gp = gpar(cex = 1.3)))

velo_visreg_inside

```

The model predicts that increased velocity leads to an increase in whiffs on pitches inside the zone, regardless of location. This aligns pretty well with the 





```{r velo visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

velo_visreg_OBL <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

velo_visreg_OBR <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

velo_visreg_OTL <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

velo_visreg_OTR <- visreg(slider_whiff_glm,
                          "velocity",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

velo_visreg_outside <- ggarrange(velo_visreg_OTL, velo_visreg_OTR,
                                 velo_visreg_OBL, velo_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Velocity (mph)",
                                    gp = gpar(cex = 1.3)))

velo_visreg_outside

```

```{r release visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

rele_visreg_IBC <- visreg(slider_whiff_glm,
                          "release_extension",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

rele_visreg_IBL <- visreg(slider_whiff_glm,
                          "release_extension",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

rele_visreg_IBR <- visreg(slider_whiff_glm,
                          "release_extension",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

rele_visreg_IMC <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

rele_visreg_IML <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

rele_visreg_IMR <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

rele_visreg_ITC <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

rele_visreg_ITL <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

rele_visreg_ITR <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

rele_visreg_inside <- ggarrange(rele_visreg_ITL, rele_visreg_ITC, 
                                rele_visreg_ITR, rele_visreg_IML, 
                                rele_visreg_IMC, rele_visreg_IMR,
                                rele_visreg_IBL, rele_visreg_IBC,
                                rele_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Release Ext. on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Release Extension (in)", gp = gpar(cex = 1.3)))

rele_visreg_inside

```


```{r release extension visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

rele_visreg_OBL <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

rele_visreg_OBR <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

rele_visreg_OTL <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

rele_visreg_OTR <- visreg(slider_whiff_glm,
                          "release_extension",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

rele_visreg_outside <- ggarrange(rele_visreg_OTL, rele_visreg_OTR,
                                 rele_visreg_OBL, rele_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Release Ext. on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Release Extension (in))",
                                    gp = gpar(cex = 1.3)))

rele_visreg_outside

```

```{r spin rate visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

spin_visreg_IBC <- visreg(slider_whiff_glm,
                          "spin_rate",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

spin_visreg_IBL <- visreg(slider_whiff_glm,
                          "spin_rate",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

spin_visreg_IBR <- visreg(slider_whiff_glm,
                          "spin_rate",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

spin_visreg_IMC <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

spin_visreg_IML <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

spin_visreg_IMR <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

spin_visreg_ITC <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

spin_visreg_ITL <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

spin_visreg_ITR <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

spin_visreg_inside <- ggarrange(spin_visreg_ITL, spin_visreg_ITC, 
                                spin_visreg_ITR, spin_visreg_IML, 
                                spin_visreg_IMC, spin_visreg_IMR,
                                spin_visreg_IBL, spin_visreg_IBC,
                                spin_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Spin Rate on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Spin Rate (rpm)", gp = gpar(cex = 1.3)))

spin_visreg_inside

```


```{r spin rate visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

spin_visreg_OBL <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

spin_visreg_OBR <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

spin_visreg_OTL <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

spin_visreg_OTR <- visreg(slider_whiff_glm,
                          "spin_rate",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

spin_visreg_outside <- ggarrange(spin_visreg_OTL, spin_visreg_OTR,
                                 spin_visreg_OBL, spin_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Spin Rate on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Spin Rate (rpm)",
                                    gp = gpar(cex = 1.3)))

spin_visreg_outside

```

```{r horizontal break visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

horz_visreg_IBC <- visreg(slider_whiff_glm,
                          "horizontal_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

horz_visreg_IBL <- visreg(slider_whiff_glm,
                          "horizontal_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

horz_visreg_IBR <- visreg(slider_whiff_glm,
                          "horizontal_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

horz_visreg_IMC <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

horz_visreg_IML <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

horz_visreg_IMR <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

horz_visreg_ITC <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

horz_visreg_ITL <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

horz_visreg_ITR <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

horz_visreg_inside <- ggarrange(horz_visreg_ITL, horz_visreg_ITC, 
                                horz_visreg_ITR, horz_visreg_IML, 
                                horz_visreg_IMC, horz_visreg_IMR,
                                horz_visreg_IBL, horz_visreg_IBC,
                                horz_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Horziontal Break on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Horizontal Break (in)", gp = gpar(cex = 1.3)))

horz_visreg_inside

```


```{r horizontal break visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

horz_visreg_OBL <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

horz_visreg_OBR <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

horz_visreg_OTL <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

horz_visreg_OTR <- visreg(slider_whiff_glm,
                          "horizontal_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

horz_visreg_outside <- ggarrange(horz_visreg_OTL, horz_visreg_OTR,
                                 horz_visreg_OBL, horz_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Horizontal Break on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Horizontal Break (in))",
                                    gp = gpar(cex = 1.3)))

horz_visreg_outside

```

```{r release visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

vert_visreg_IBC <- visreg(slider_whiff_glm,
                          "vertical_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

vert_visreg_IBL <- visreg(slider_whiff_glm,
                          "vertical_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

vert_visreg_IBR <- visreg(slider_whiff_glm,
                          "vertical_break",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

vert_visreg_IMC <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

vert_visreg_IML <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

vert_visreg_IMR <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

vert_visreg_ITC <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

vert_visreg_ITL <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

vert_visreg_ITR <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

vert_visreg_inside <- ggarrange(vert_visreg_ITL, vert_visreg_ITC, 
                                vert_visreg_ITR, vert_visreg_IML, 
                                vert_visreg_IMC, vert_visreg_IMR,
                                vert_visreg_IBL, vert_visreg_IBC,
                                vert_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Vertical Break on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Vertical Break (in)", gp = gpar(cex = 1.3)))

vert_visreg_inside

```


```{r vertical break visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

vert_visreg_OBL <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

vert_visreg_OBR <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

vert_visreg_OTL <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

vert_visreg_OTR <- visreg(slider_whiff_glm,
                          "vertical_break",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

vert_visreg_outside <- ggarrange(vert_visreg_OTL, vert_visreg_OTR,
                                 vert_visreg_OBL, vert_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Vertical Break. on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Vertical Break (in))",
                                    gp = gpar(cex = 1.3)))

vert_visreg_outside

```

```{r rise visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

rise_visreg_IBC <- visreg(slider_whiff_glm,
                          "rise",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

rise_visreg_IBL <- visreg(slider_whiff_glm,
                          "rise",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

rise_visreg_IBR <- visreg(slider_whiff_glm,
                          "rise",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

rise_visreg_IMC <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

rise_visreg_IML <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

rise_visreg_IMR <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

rise_visreg_ITC <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

rise_visreg_ITL <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

rise_visreg_ITR <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

rise_visreg_inside <- ggarrange(rise_visreg_ITL, rise_visreg_ITC, 
                                rise_visreg_ITR, rise_visreg_IML, 
                                rise_visreg_IMC, rise_visreg_IMR,
                                rise_visreg_IBL, rise_visreg_IBC,
                                rise_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Rise on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Rise (in)", gp = gpar(cex = 1.3)))

rise_visreg_inside

```


```{r rise visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

rise_visreg_OBL <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

rise_visreg_OBR <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

rise_visreg_OTL <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

rise_visreg_OTR <- visreg(slider_whiff_glm,
                          "rise",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

rise_visreg_outside <- ggarrange(rise_visreg_OTL, rise_visreg_OTR,
                                 rise_visreg_OBL, rise_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Rise on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Rise (in))",
                                    gp = gpar(cex = 1.3)))

rise_visreg_outside

```

```{r tail visreg inside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

tail_visreg_IBC <- visreg(slider_whiff_glm,
                          "tail",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 1)

tail_visreg_IBL <- visreg(slider_whiff_glm,
                          "tail",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 2)

tail_visreg_IBR <- visreg(slider_whiff_glm,
                          "tail",
                           gg = TRUE,
                           by = "zone",
                           partial = FALSE,
                           rug = FALSE,
                           line.par = list(col = "black",
                                           alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 3)

tail_visreg_IMC <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 4)

tail_visreg_IML <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 5)

tail_visreg_IMR <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 6)

tail_visreg_ITC <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 11)

tail_visreg_ITL <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 12)

tail_visreg_ITR <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 13)

tail_visreg_inside <- ggarrange(tail_visreg_ITL, tail_visreg_ITC, 
                                tail_visreg_ITR, tail_visreg_IML, 
                                tail_visreg_IMC, tail_visreg_IMR,
                                tail_visreg_IBL, tail_visreg_IBC,
                                tail_visreg_IBR,
                                ncol = 3,
                                nrow = 3) %>% 
  annotate_figure(top = text_grob("Effect of Tail on Whiff Likelihood on Pitches Inside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean", rot = 90, vjust = 1, gp = gpar(cex = 1.3)),
                  bottom = textGrob("Tail (in)", gp = gpar(cex = 1.3)))

tail_visreg_inside

```


```{r tail visreg outside, echo = FALSE, message = FALSE, warning = FALSE, results = TRUE}

::: {.panel-tabset}

tail_visreg_OBL <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 7)

tail_visreg_OBR <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 8)

tail_visreg_OTL <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 9)

tail_visreg_OTR <- visreg(slider_whiff_glm,
                          "tail",
                          gg = TRUE,
                          by = "zone",
                          partial = FALSE,
                          rug = FALSE,
                          line.par = list(col = "black",
                                          alpha = 1)) +
  geom_point(aes(color = zone),
             size = 1, alpha = 0.1) +
  theme_minimal() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "none") +
  facet_grid_paginate(~factor(zone),
                      ncol = 1,
                      nrow = 1,
                      page = 10)

tail_visreg_outside <- ggarrange(tail_visreg_OTL, tail_visreg_OTR,
                                 tail_visreg_OBL, tail_visreg_OBR,
                                 ncol = 2,
                                 nrow = 2) %>% 
  annotate_figure(top = text_grob("Effect of Tail on Whiff Likelihood on Pitches Outside the Zone",
                                 color = "black",
                                 face = "bold",
                                 size = 15),
                  left = textGrob("Whiff Ratio Relative to the Mean",
                                  rot = 90,
                                  vjust = 1,
                                  gp = gpar(cex = 1.3)),
                  bottom = textGrob("Tail (in))",
                                    gp = gpar(cex = 1.3)))

tail_visreg_outside

```


1. finish ggparagraphs
2. confirm that CIs are on visregs - might be very small
3. make tables of emmeans for each plot to provide numerical context to plots
4. predictions? plug in exact values of predictors and determine what whiffs would be relative to mean
   ----- see code below for this





# ```{r model prediction df, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}
# 
# model_prediction_df <- data.frame(swings = sample(0:1000,
#                                                   size = 10000,
#                                                   replace = TRUE),
#                                   whiffs = sample(0:300,
#                                                   size = 10000,
#                                                   replace = TRUE),
#                                   velocity = sample(65:100,
#                                                     size = 10000,
#                                                     replace = TRUE),
#                                   spin_rate = sample(1000:3500,
#                                                      size = 10000,
#                                                      replace = TRUE),
#                                   release_extension = sample(3.5:9,
#                                                              size = 10000,
#                                                              replace = TRUE),
#                                   horizontal_break = sample(0:25,
#                                                             size = 10000,
#                                                             replace = TRUE),
#                                   vertical_break = sample(20:65,
#                                                           size = 10000,
#                                                           replace = TRUE),
#                                   rise = sample(-35:50,
#                                                 size = 10000,
#                                                 replace = TRUE),
#                                   tail = sample(-350:300,
#                                                 size = 10000,
#                                                 replace = TRUE),
#                                   zone = sample(
#                                     c("Top Left", "Top Center", "Top Right",
#                                       "Middle Left", "Middle Center", "Middle Right",
#                                       "Bottom Left", "Bottom Center", "Bottom Right", 
#                                       "Outside Top Left", "Outside Top Right", 
#                                       "Outside Bottom Left", "Outside Bottom Right"),
#                                     size = 10000,
#                                     replace = TRUE))
# 
# ```
# 
# ```{r confidence and prediction intervals, echo = FALSE, message = FALSE, warning = FALSE, results = FALSE}
# 
# library(broom)
# 
# slider_velo_prediction <- predict(slider_whiff_glm,
#                              newdata = model_prediction_df,
#                              type = "response",
#                              se.fit = TRUE)
# 
# 
# slider_confidence <- augment(slider_whiff_glm,
#                               newdata = model_prediction_df,
#                               type.predict = "response",
#                               se = TRUE) %>% 
#   mutate(
#     
#     
#     lower_CI = (.fitted - 2*.se.fit),
#          upper_CI = (.fitted + 2*.se.fit),
#          lower_PI = qpois(0.025, lambda = .fitted),
#          upper_PI = qpois(0.975, lambda = .fitted))
#   )
# 
# 
# ```


